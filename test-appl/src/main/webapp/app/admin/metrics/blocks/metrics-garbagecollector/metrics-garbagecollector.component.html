<h3 id="garbageCollectorMetrics" appTranslate="metrics.jvm.gc.title">Garbage collections</h3>

<div class="p-grid">
  <div class="p-col-4">
    @if (garbageCollectorMetrics()) {
      <div>
        <span>
          GC Live Data Size/GC Max Data Size ({{ garbageCollectorMetrics()!['jvm.gc.live.data.size'] / 1048576 | number: '1.0-0' }}M /
          {{ garbageCollectorMetrics()!['jvm.gc.max.data.size'] / 1048576 | number: '1.0-0' }}M)
        </span>

        <p-progressBar
          [value]="(garbageCollectorMetrics()!['jvm.gc.live.data.size'] / garbageCollectorMetrics()!['jvm.gc.max.data.size']) * 100"
          [mode]="'determinate'"
          [styleClass]="'ui-progressbar-success'"
        >
          <div class="p-progressbar-label">
            {{
              (100 * garbageCollectorMetrics()!['jvm.gc.live.data.size']) / garbageCollectorMetrics()!['jvm.gc.max.data.size']
                | number: '1.0-2'
            }}%
          </div>
        </p-progressBar>
      </div>
    }
  </div>

  <div class="p-col-4">
    @if (garbageCollectorMetrics()) {
      <div *ngIf="garbageCollectorMetrics">
        <span>
          GC Memory Promoted/GC Memory Allocated ({{ garbageCollectorMetrics()!['jvm.gc.memory.promoted'] / 1048576 | number: '1.0-0' }}M /
          {{ garbageCollectorMetrics()!['jvm.gc.memory.allocated'] / 1048576 | number: '1.0-0' }}M)
        </span>

        <p-progressBar
          [value]="(garbageCollectorMetrics()!['jvm.gc.memory.promoted'] / garbageCollectorMetrics()!['jvm.gc.memory.allocated']) * 100"
          [mode]="'determinate'"
          [styleClass]="'ui-progressbar-success'"
        >
          <div class="p-progressbar-label">
            {{
              (100 * garbageCollectorMetrics()!['jvm.gc.memory.promoted']) / garbageCollectorMetrics()!['jvm.gc.memory.allocated']
                | number: '1.0-2'
            }}%
          </div>
        </p-progressBar>
      </div>
    }
  </div>

  <div id="garbageCollectorMetrics" class="p-col-4">
    @if (garbageCollectorMetrics()) {
      <div class="p-grid" *ngIf="garbageCollectorMetrics">
        <div class="p-col-9">Classes loaded</div>
        <div class="p-col-3 text-end">{{ garbageCollectorMetrics()!.classesLoaded }}</div>
      </div>
      <div class="p-grid" *ngIf="garbageCollectorMetrics">
        <div class="p-col-9">Classes unloaded</div>
        <div class="p-col-3 text-end">{{ garbageCollectorMetrics()!.classesUnloaded }}</div>
      </div>
    }
  </div>

  @if (!updating() && garbageCollectorMetrics()) {
    <div class="table-responsive" *ngIf="!updating && garbageCollectorMetrics">
      <p-table data-cy="MetricsGarbageCollectorTable" [value]="[]">
        <ng-template pTemplate="header">
          <tr>
            <th scope="col"></th>
            <th scope="col" class="text-end" appTranslate="metrics.servicesstats.table.count">Count</th>
            <th scope="col" class="text-end" appTranslate="metrics.servicesstats.table.mean">Mean</th>
            <th scope="col" class="text-end" appTranslate="metrics.servicesstats.table.min">Min</th>
            <th scope="col" class="text-end" appTranslate="metrics.servicesstats.table.p50">p50</th>
            <th scope="col" class="text-end" appTranslate="metrics.servicesstats.table.p75">p75</th>
            <th scope="col" class="text-end" appTranslate="metrics.servicesstats.table.p95">p95</th>
            <th scope="col" class="text-end" appTranslate="metrics.servicesstats.table.p99">p99</th>
            <th scope="col" class="text-end" appTranslate="metrics.servicesstats.table.max">Max</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-rowData>
          <tr [attr.data-cy]="'MetricsGarbageCollectorTableRow_' + rowData.id"></tr>
          <tr>
            <td>jvm.gc.pause</td>
            <td class="text-end">{{ garbageCollectorMetrics()!['jvm.gc.pause'].count }}</td>
            <td class="text-end">{{ garbageCollectorMetrics()!['jvm.gc.pause'].mean | number: '1.0-3' }}</td>
            <td class="text-end">{{ garbageCollectorMetrics()!['jvm.gc.pause']['0.0'] | number: '1.0-3' }}</td>
            <td class="text-end">{{ garbageCollectorMetrics()!['jvm.gc.pause']['0.5'] | number: '1.0-3' }}</td>
            <td class="text-end">{{ garbageCollectorMetrics()!['jvm.gc.pause']['0.75'] | number: '1.0-3' }}</td>
            <td class="text-end">{{ garbageCollectorMetrics()!['jvm.gc.pause']['0.95'] | number: '1.0-3' }}</td>
            <td class="text-end">{{ garbageCollectorMetrics()!['jvm.gc.pause']['0.99'] | number: '1.0-3' }}</td>
            <td class="text-end">{{ garbageCollectorMetrics()!['jvm.gc.pause'].max | number: '1.0-3' }}</td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  }
</div>
